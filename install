#!/usr/bin/env zsh

set -ex

cd "$(dirname "${0:A}")"

files=(
    bash-completion
    bin
    gitconfig
    inputrc
    vim
    vimrc
    zsh-completion
    zshrc
)

for file in "${files[@]}"; do
    dest="${HOME}/.${file}"
    rm -rf $dest
    ln -sf "${PWD}/${file}" "$dest"
done

############### Upstream completion scripts ###############

function download_file {
    local src=$1
    local dest=$2
    shift 2

    if [[ ! -f $dest ]]; then
        mkdir -p "$(dirname $dest)"
        curl -o $dest $src "$@"
    fi
}

git_version='2.24.3'
git_completion_url="https://raw.githubusercontent.com/git/git/v${git_version}/contrib/completion"
download_file "${git_completion_url}/git-completion.bash" ~/.bash-completion/git-completion.bash
download_file "${git_completion_url}/git-completion.zsh" ~/.zsh-completion/_git

############### Brew dependencies ###############

if ! type brew &> /dev/null; then
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

brew bundle
