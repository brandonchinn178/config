#!/bin/bash

# git tab completion
source /usr/local/bin/git-completion.bash

# exit non-zero if not a git repo
function is_repo() {
    git rev-parse HEAD &> /dev/null
}

# exit non-zero if not a git worktree
function is_worktree() {
    if is_repo; then
        (root && [[ $(git rev-parse --git-dir) != ".git" ]])
    else
        return 1
    fi
}

# get the name of the current repo; works in worktrees
function get_repo() {
    GIT_URL=$(git remote -v | grep origin | head -n 1 | awk '{ print $2 }')
    basename "$(sed 's|\.git$||' <<< "$GIT_URL")"
}

# get the current branch, or the commit hash if not on a branch
function get_branch() {
    local label=$(git rev-parse --abbrev-ref HEAD)
    if [[ $label == "HEAD" ]]; then
        git rev-parse --short=8 HEAD
    else
        echo $label
    fi
}
