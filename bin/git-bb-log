#!/usr/bin/env zsh

set -eu -o pipefail

function git_bb_log {
    local start=HEAD~10

    local base="$(git bb --base)"
    if [[ -n $base ]]; then
        start="$(git merge-base $base HEAD)"
    fi

    local range="${start}^".."HEAD"
    if ! git show "${start}^" &> /dev/null; then
        range=--root
    fi

    exec git log --first-parent "$@" $range
}

git_bb_log "$@"
